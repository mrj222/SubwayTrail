# SubwayTrail

## 数据预处理

data.py 对数据进行预处理，将一天的基站数据划分为每个user的数据，并把每个人的数据按照时间先后顺序排好序。

## 根据每个人的数据确定乘坐地铁轨迹

1. trail.py  

   大致想法是，某个人时刻A在基站X的范围之内，时刻B在基站Y的范围之内，那么认为ta在$$\frac{A+B}{2}$$时刻恰好位于$$\frac{X+Y}{2}$$处，以此方法估计ta的运动轨迹。在确定ta是否乘坐地铁时，考虑距离ta的位置最近的地铁站，将运动轨迹映射到地铁轨道上，最后选择合理的部分。

2. trail_2.py

   大致想法是，首先预处理所有基站，筛选出基站范围和地铁轨道有交的基站。对于每个人的数据，首先剔除和地铁轨道无交的地铁站；对于有交的，分为两种：一种是覆盖了多个地铁站，一种是没有覆盖地铁站，仅仅和两个站之间的轨道有交。然后对于数据做一步处理，找到合理的几段轨迹，然后确定开始站和结束站。

两个方法对于轨迹的合理性的考虑比较相似，主要认为数据中人的”移动速度“应该在一定范围之内。地铁的平均速度大约在30km/h，因此人的移动速度不能超过太多。

最后给出的结果文件输出乘地铁者的以下信息：

usr_num(用于标识usr)，start_station，end_station，start_time，end_time

注：方法1的代码疑似有bug，结果和代码里面对于速度的限制有冲突。

## 反推地铁运行时刻

在subway_time.py中实现。

想法是，首先根据地铁的运行间隔、平均运行速度等，对于每一个乘地铁者的信息，计算出如果地铁按照这个运行，[17:00:00, 17:10:00]之间的一班车出发时刻。然后寻找一个长度为T的区间(T的大小可调)，使得该区间内包含最多的出发车次，作为置信区间。

